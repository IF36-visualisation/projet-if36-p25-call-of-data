---
title: "Rapport"
author: "Ahamad MOHAMMAD; Minko Bikono NEIL-JOVY; Simon GELBART; Willen AMICHE"
date: "`r Sys.Date()`"
output:
  pdf_document:
    latex_engine: xelatex
---


## **Introduction**

Notre objectif est d‚Äôexplorer l‚Äôimpact des strat√©gies de recrutement sur les performances sportives des clubs et joueurs. En combinant des statistiques individuelles, collectives et des donn√©es de transferts, nous chercherons √† identifier les tendances qui influencent la r√©ussite des √©quipes sur plusieurs saisons. 


### **üìä Description des variables**

#### - üßç‚Äç‚ôÇÔ∏è Player Stats 2021-2022 (`2021-2022 Football Player Stats.csv`)

143 variables ‚Äì chaque ligne correspond √† un joueur pour la saison 2021-2022.

| Variable          | Type      | Description approximative |
|-------------------|-----------|----------------------------|
| `Rk`              | int64     | Rang ou ID du joueur       |
| `Player`          | object    | Nom du joueur              |
| `Nation`          | object    | Nationalit√©                |
| `Pos`             | object    | Poste                      |
| `Squad`           | object    | Club                       |
| `Comp`            | object    | Comp√©tition principale     |
| `Age`             | object    | √Çge                        |
| `Born`            | object    | Ann√©e de naissance         |
| ...               | ...       | ...et plus de 130 autres statistiques de jeu : buts, passes, tirs, dribbles, fautes, tacles, interceptions, passes progressives, etc. |
| `AerWon`          | float64   | Duels a√©riens gagn√©s       |
| `AerLost`         | float64   | Duels a√©riens perdus       |
| `AerWon%`         | float64   | Pourcentage de duels a√©riens gagn√©s |

---

#### - üèüÔ∏è Team Stats 2021-2022 (`2021-2022 Football Team Stats.csv`)

20 variables ‚Äì chaque ligne correspond √† une √©quipe.

| Variable          | Type      | Description |
|------------------|-----------|-------------|
| `Rk`             | int64     | Rang        |
| `Squad`          | object    | Nom du club |
| `Country`        | object    | Pays        |
| `LgRk`           | int64     | Classement dans la ligue |
| `MP`, `W`, `D`, `L` | int64  | Matchs jou√©s, Victoires, Nuls, D√©faites |
| `GF`, `GA`, `GD` | int64     | Buts pour, contre, diff√©rence |
| `Pts`, `Pts/G`   | int64 / float64 | Points et moyenne par match |
| `xG`, `xGA`, `xGD`, `xGD/90` | float64 | Donn√©es d‚Äôexpected goals |
| `Attendance`     | int64     | Affluence moyenne |
| `Top Team Scorer`| object    | Meilleur buteur |
| `Goalkeeper`     | object    | Gardien principal |

---

#### - üèüÔ∏è Team Stats 2022-2023 (`2022-2023 Football Team Stats.csv`)

M√™me structure et signification que pour 2021-2022, mais avec la saison suivante.

---

#### - üîÑ Transfers √ât√© 2022 (`2022_2023_football_summer_transfers.csv`)

11 variables ‚Äì chaque ligne correspond √† un transfert.

| Variable        | Type    | Description |
|----------------|---------|-------------|
| `name`         | object  | Nom du joueur transf√©r√© |
| `position`     | object  | Poste            |
| `age`          | object  | √Çge              |
| `market_value` | object  | Valeur estim√©e   |
| `country_from` | object  | Pays de d√©part   |
| `league_from`  | object  | Ligue de d√©part  |
| `club_from`    | object  | Club de d√©part   |
| `country_to`   | object  | Pays d‚Äôarriv√©e   |
| `league_to`    | object  | Ligue d‚Äôarriv√©e  |
| `club_to`      | object  | Club d‚Äôarriv√©e   |
| `fee`          | object  | Montant du transfert (peut contenir "Free", "Loan", etc.) |

---

## **Analyse et r√©ponses aux questions**


```{r chargement-librairies, message=FALSE}
# Chargement des packages n√©cessaires

library(tidyverse)
library(ggplot2)
```


```{r importation-donnees, message=FALSE, warning=FALSE}
# Importation des donn√©es

player_stats_2021_2022 <- read.csv("data/2021-2022 Football Player Stats.csv", sep = ";", fileEncoding = "ISO-8859-1")
team_stats_2021_2022 <- read.csv("data/2021-2022 Football Team Stats.csv", sep = ";", fileEncoding = "ISO-8859-1")
team_stats_2022_2023 <- read.csv("data/2022-2023 Football Team Stats.csv", sep = ";", fileEncoding = "ISO-8859-1")
transfers_2022 <- read.csv("data/2022_2023_football_summer_transfers.csv", sep = ",", fileEncoding = "ISO-8859-1")
```

---

### **Question 1:** Quels clubs ont le plus recrut√© par poste (top 20) ?

#### üéØ Objectif:
Identifier les **20 clubs les plus actifs** lors du mercato d‚Äô√©t√© 2022 en termes de nombre de recrues, puis visualiser quels postes ont √©t√© cibl√©s en priorit√© par ces clubs. Cela permet de mieux comprendre les **strat√©gies de renforcement** des effectifs selon les lignes de jeu (d√©fense, milieu, attaque).



```{r message=FALSE}
# Code

# Nettoyage de base
transfers_clean <- transfers_2022 %>%
  filter(!is.na(club_to), !is.na(position), position != "")

# Regrouper et compter
recrutements_par_poste <- transfers_clean %>%
  group_by(club_to, position) %>%
  summarise(nb_recrues = n(), .groups = "drop")

# Garder uniquement les 20 clubs ayant recrut√© le plus globalement
top_clubs <- recrutements_par_poste %>%
  group_by(club_to) %>%
  summarise(total_recrues = sum(nb_recrues)) %>%
  top_n(20, total_recrues) %>%
  pull(club_to)

# Filtrer les donn√©es
recrutements_top <- recrutements_par_poste %>%
  filter(club_to %in% top_clubs)

# Visualisation 
ggplot(recrutements_top, aes(x = position, y = fct_reorder(club_to, nb_recrues), fill = nb_recrues)) +
  geom_tile(color = "white") +
  scale_fill_gradient(low = "lightblue", high = "darkblue") +
  labs(
    title = "Top 20 clubs ‚Äì nombre de recrues par poste (√©t√© 2022)",
    x = "Poste",
    y = "Club",
    fill = "Nombre de recrues"
  ) +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

#### üß† Interpr√©tation du graphique:

- üîµ **US Salernitana 1919** est le club qui a le plus recrut√© tous postes confondus, avec un **focus important sur les milieux offensifs** et **d√©fenseurs centraux**.

- üîµ **US Lecce**, **US Cremonese** et **Udinese Calcio** (clubs italiens) montrent aussi une strat√©gie de **renforcement d√©fensif**, particuli√®rement en **centre-back**.

- üîµ **Olympique de Marseille** et **Nottingham Forest** ont **diversifi√© leurs recrutements** sur plusieurs lignes, y compris **les ailes** (*left/right winger*).

- üéØ On observe une **forte demande en milieux de terrain**, notamment :
  - *Attacking Midfield*
  - *Defensive Midfield*
  - *Centre Midfield*

-  Peu de clubs ont recrut√© plusieurs **gardiens**, ce qui est logique : un club n‚Äôen fait souvent venir qu‚Äôun seul par saison.

-  Certains clubs comme **FC Empoli** ou **OGC Nice** pr√©sentent une strat√©gie de recrutement **√©quilibr√©e sur diff√©rentes lignes**, ce qui pourrait indiquer un **renouvellement global de l‚Äôeffectif**.


---

### **Question 2:** Quels postes sont les plus valoris√©s sur le march√© ?


#### üéØ Objectif:
Visualiser la valeur marchande des joueurs par poste pour comprendre quels types de profils sont les plus pris√©s financi√®rement sur le march√©. Cela permet de hi√©rarchiser les postes selon leur importance √©conomique dans le football professionnel. Pour √ßa, on se base sur le mercato qui a eu lieu durant l'√©t√© 2022.


```{r message=FALSE}

transfers_clean <- transfers_2022 %>%
  filter(!is.na(position), !is.na(market_value)) %>%
  distinct(name, position, age, .keep_all = TRUE) %>%
  mutate(
    market_value = gsub("[^0-9\\.]", "", market_value),  # pour Retirer tout sauf chiffres et point
    market_value_num = as.numeric(market_value)
  ) %>%
  filter(market_value_num >= 1.5)

# On cr√©e une colonne pour regrouper certains postes qui sont tr√®s proches
transfers_clean <- transfers_clean %>%
  mutate(position_fr = position) %>%
  mutate(position_fr = recode(position_fr,
                              "Second Striker" = "Attaquant",
                              "Centre-Forward" = "Attaquant",
                              "Forward Attacker" = "Attaquant",
                              "attack" = "Attaquant",
                              "Right Midfield" = "Ailier droit",
                              "Left Midfield" = "Ailier gauche",
                              "Attacking Midfield" = "Milieu offensif",
                              "Central Midfield" = "Milieu central",
                              "Defensive Midfield" = "Milieu central", 
                              "Centre-Back" = "D√©fenseur central",
                              "defence" = "D√©fenseur central",
                              "Right Winger" = "Ailier droit",
                              "Left Winger" = "Ailier gauche", 
                              "Left-Back" = "D√©fenseur gauche",
                              "Right-Back" = "D√©fenseur droit",
                              "Goalkeeper" = "Gardien de but",
                              .default = position_fr))  # Par d√©faut, on garde la position d'origine

# Calcul de la moyenne et de l'√©cart-type des valeurs marchandes par poste
transfers_clean_stats <- transfers_clean %>%
  group_by(position_fr) %>%
  filter(n() >= 5) %>%  
  summarise(
    mean_value = mean(market_value_num, na.rm = TRUE),
    sd_value = sd(market_value_num, na.rm = TRUE)
  )

# Visualisation avec un barplot et des barres d'erreur pour voir les postes qui ont une grosse diff√©rence de prix
ggplot(transfers_clean_stats, aes(x = reorder(position_fr, mean_value), y = mean_value)) +
  geom_bar(stat = "identity", fill = "#4CAF50") +  
  geom_errorbar(aes(ymin = pmax(mean_value - sd_value, 0), ymax = mean_value + sd_value), width = 0.2) +
  labs(
    title = "Valeur marchande moyenne par poste (mercato √©t√© 2022)",
    x = "Poste",
    y = "Valeur marchande moyenne (Millions d'‚Ç¨)"
  ) +
  theme_minimal(base_size = 12) +
  coord_flip()

```


#### üß† Interpr√©tation du graphique:

- üîµ Attaquants sont les joueurs les plus valoris√©s sur le march√©, avec une valeur moyenne bien sup√©rieure aux autres postes. Cela refl√®te leur importance dans le football moderne o√π les performances offensives et l'impact marketing sont d√©cisifs.

- üîµ D√©fenseurs centraux occupent la deuxi√®me place en termes de valeur. Leur r√¥le dans la stabilit√© d√©fensive et l'organisation du jeu explique cette valorisation √©lev√©e.

- üîµ Ailiers droits et gauches pr√©sentent √©galement des valeurs importantes, avec une survalorisation l√©g√®re des ailiers droits, souvent gauchers et capables de repiquer dans l'axe, profil tr√®s recherch√© aujourd'hui.

- üîµ Milieux centraux sont tr√®s valoris√©s gr√¢ce √† leur polyvalence et leur influence dans le jeu, tandis que les milieux offensifs voient leur valeur d√©cliner, en lien avec l‚Äô√©volution des syst√®mes de jeu modernes.

- üîµ D√©fenseurs lat√©raux (gauche et droit) restent recherch√©s pour leur polyvalence attaque/d√©fense, avec une l√©g√®re valeur sup√©rieure pour les lat√©raux gauches.

- üîµ Gardiens de but sont nettement moins valoris√©s, leur poste √©tant moins "vendeur" et tr√®s sp√©cifique par rapport aux autres.

---


### **Question 3:** Corr√©lation entre xG (expected goals) et points ? 

#### üéØ Objectif:

Analyser si le nombre d‚Äôexpected goals (xG) r√©alis√©s par une √©quipe est corr√©l√© avec son total de points en championnat. Cela permet de v√©rifier si produire beaucoup d‚Äôoccasions (m√™me sans forc√©ment marquer) est un bon indicateur de performance globale.
On utilise les donn√©es de la saison 2022-2023.


```{r message=FALSE}
# On utilise les donn√©es de la saison 2022-2023
team_stats_22_23 <- team_stats_2022_2023 %>%
  select(Squad, xG, Pts)

# Nettoyage basique : on supprime les NA au cas o√π
team_stats_22_23 <- team_stats_22_23 %>%
  filter(!is.na(xG), !is.na(Pts))

# Visualisation scatter plot
ggplot(team_stats_22_23, aes(x = xG, y = Pts)) +
  geom_point(color = "#1f77b4", size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = "red", linetype = "dashed") +
  labs(
    title = "Corr√©lation entre Expected Goals (xG) et Points en championnat (2022-23)",
    x = "Expected Goals (xG)",
    y = "Points",
  ) +
  theme_minimal(base_size = 12)

```


#### üß† Interpr√©tation du graphique:

- üîµ Le graphique montre une forte corr√©lation positive entre les expected goals (xG) et les points obtenus lors de la saison 2022-2023

- üîµ Cela confirme que cr√©er des occasions de qualit√© est un facteur cl√© de r√©ussite sur une saison.

- üîµ Toutefois, certains clubs s'√©cartent de la tendance, montrant que l'efficacit√© offensive ou la solidit√© d√©fensive influencent aussi fortement les r√©sultats.

- üéØ En r√©sum√©, les xG sont un tr√®s bon indicateur de performance, mais ils doivent √™tre combin√©s √† d'autres aspects du jeu pour expliquer compl√®tement le succ√®s d'une √©quipe.

---

### **Question 4:** Quel est l'impact des transferts sur la performance des clubs entre 2021-2022 et 2022-2023 ?


#### üéØ Objectif:

Analyser l'√©volution de la performance des clubs entre deux saisons (2021-2022 ‚ûî 2022-2023) en fonction de leur nombre de recrues durant l'√©t√© 2022.
L'objectif est de voir s'il existe une corr√©lation entre l'activit√© sur le march√© des transferts (quantit√© de recrutements) et l'√©volution du classement d'une saison sur l'autre.



```{r message=FALSE}
# Regrouper les clubs qui ont recrut√© et compter
nb_recrues_club <- transfers_clean %>%
  group_by(club_to) %>%
  summarise(nb_recrues = n(), .groups = "drop")

# Pr√©parer les classements par saison
classements_2021_2022 <- team_stats_2021_2022 %>%
  select(Squad, LgRk) %>%
  rename(club = Squad, classement_2022 = LgRk)

classements_2022_2023 <- team_stats_2022_2023 %>%
  select(Squad, LgRk) %>%
  rename(club = Squad, classement_2023 = LgRk)

# Fusionner tout ensemble
evolution_clubs <- classements_2021_2022 %>%
  inner_join(classements_2022_2023, by = "club") %>%
  left_join(nb_recrues_club, by = c("club" = "club_to")) %>%
  mutate(
    nb_recrues = replace_na(nb_recrues, 0),  # certains clubs peuvent avoir 0 recrutement
    evolution_classement = classement_2022 - classement_2023
  )

# Pour la visualisation, cr√©er des classes selon nombre de recrues
evolution_clubs <- evolution_clubs %>%
  mutate(
    categorie_recrutement = case_when(
      nb_recrues == 0 ~ "0 recrue",
      nb_recrues <= 3 ~ "1-3 recrues",
      nb_recrues <= 6 ~ "4-6 recrues",
      TRUE ~ "7+ recrues"
    )
  )

# Visualisation : boxplot pour voir la distribution de l'√©volution du classement par cat√©gorie de recrutement
ggplot(evolution_clubs, aes(x = categorie_recrutement, y = evolution_classement, fill = categorie_recrutement)) +
  geom_boxplot(alpha = 0.7) +
  scale_fill_manual(values = c("lightblue", "skyblue", "blue", "darkblue")) +
  geom_hline(yintercept = 0, linetype = "dashed", color = "red") +
  labs(
    title = "Impact du recrutement sur l'√©volution du classement (2021-2023)",
    subtitle = "Distribution de l'√©volution de position en fonction du nombre de recrues estivales",
    x = "Nombre de recrues (cat√©gories)",
    y = "Evolution du classement (positif = am√©lioration)",
    fill = "Recrutements"
  ) +
  theme_minimal(base_size = 12)


```


#### üß† Interpr√©tation du graphique:

-  Le graphique √©tudie la relation entre le nombre de joueurs recrut√©s durant l‚Äô√©t√© 2022 et l'√©volution du classement entre 2021-2022 et 2022-2023.

- üîµ Clubs sans recrues : r√©sultats tr√®s variables, m√©diane proche de z√©ro.

- üîµ 1 √† 3 recrues : tendance √† une l√©g√®re d√©gradation du classement.

- üîµ 4 √† 6 recrues : am√©lioration mod√©r√©e, avec une m√©diane l√©g√®rement positive.

- üîµ 7 recrues ou plus : r√©sultats tr√®s h√©t√©rog√®nes, avec une m√©diane plut√¥t n√©gative, montrant que recruter massivement n'est pas une garantie de succ√®s.

- üéØ En r√©sum√©, le graphique souligne que recruter beaucoup n'est pas toujours efficace ; recruter intelligemment reste la meilleure strat√©gie pour progresser.

